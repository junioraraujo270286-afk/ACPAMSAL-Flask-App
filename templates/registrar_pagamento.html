{% extends "base.html" %}

{% block title %}Pagamento de Mensalidade: {{ associado.nome }}{% endblock %}

{% block page_header %}Registrar Pagamento para: <span class="text-primary">{{ associado.nome }} ({{ associado.matricula }})</span>{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-6 mb-4">
        <div class="card shadow-sm">
            <div class="card-header bg-danger text-white">
                Meses em Aberto (Devidos)
            </div>
            <div class="card-body">
                {% if meses_devidos_lista %}
                    <p class="card-text">Total de **{{ meses_devidos_lista|length }}** meses em aberto (incluindo o mês atual). Clique no botão para registrar o pagamento.</p>
                    <ul class="list-group">
                        {% for mes in meses_devidos_lista %}
                        <li class="list-group-item d-flex justify-content-between align-items-center bg-light text-dark mb-2 rounded border border-danger">
                            <strong class="text-danger">{{ mes.strftime('%B de %Y') }}</strong>
                            <form method="POST" action="{{ url_for('registrar_pagamento', associado_id=associado_id) }}" class="d-inline">
                                <input type="hidden" name="mes_ano" value="{{ mes.strftime('%Y-%m') }}">
                                <input type="hidden" name="acao" value="registrar">
                                <button type="submit" class="btn btn-sm btn-success">
                                    <i class="bi bi-check-circle-fill"></i> Registrar Pagamento
                                </button>
                            </form>
                        </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <div class="alert alert-success mb-0">
                        <i class="bi bi-check-all"></i> O associado está em dia!
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-md-6 mb-4">
        <div class="card shadow-sm">
            <div class="card-header bg-secondary text-white">
                Remover Pagamento (Estorno)
            </div>
            <div class="card-body">
                <p class="card-text">Selecione o mês pago para remover o registro (estorno/erro).</p>
                <form method="POST" action="{{ url_for('registrar_pagamento', associado_id=associado_id) }}">
                    <div class="input-group mb-3">
                        <input type="month" class="form-control" name="mes_ano" value="{{ now.strftime('%Y-%m') }}" required>
                        <input type="hidden" name="acao" value="remover">
                        <button class="btn btn-danger" type="submit" onclick="return confirm('Tem certeza que deseja remover o pagamento deste mês?');">
                            <i class="bi bi-trash-fill"></i> Remover Pagamento
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <a href="{{ url_for('gerenciar_mensalidades_web') }}" class="btn btn-outline-secondary mt-3"><i class="bi bi-arrow-left-circle"></i> Voltar</a>
    </div>
</div>

{% endblock %}
