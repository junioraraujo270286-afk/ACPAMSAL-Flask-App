{% extends "base.html" %}
{% block title %}Meu Perfil - {{ associado.nome }}{% endblock %}
{% block content %}

<div class="row">
    <div class="col-md-12">
        <h2 class="text-primary">üë§ Meu Perfil</h2>
        <p class="text-muted">Aqui voc√™ pode visualizar seus **dados cadastrais**.</p>
        <hr>
    </div>
</div>

<div class="row">
    <div class="col-md-3 mb-4 text-center">
        {% if associado.foto_base64 %}
            <img src="{{ url_for('serve_file', filename=associado.foto_perfil) if associado.foto_perfil else 'https://via.placeholder.com/150' }}" class="img-fluid rounded">
        {% else %}
            <i class="fas fa-user-circle fa-7x text-secondary"></i>
        {% endif %}

        <form method="POST" enctype="multipart/form-data" class="mt-3">
            <div class="mb-2">
                <input type="file" class="form-control form-control-sm" name="foto" accept="image/*">
            </div>
            <button type="submit" class="btn btn-sm btn-outline-success w-100">Atualizar Foto</button>
            {% if associado.foto_base64 %}
                <button type="submit" name="remover_foto" class="btn btn-sm btn-outline-danger mt-1 w-100">Remover Foto</button>
            {% endif %}
        </form>
    </div>

    <div class="col-md-5 mb-4">
        <h4>Dados Cadastrais</h4>
        <ul class="list-group list-group-flush">
            <li class="list-group-item"><strong>Matr√≠cula:</strong> {{ associado.matricula }}</li>
            <li class="list-group-item"><strong>Nome Completo:</strong> {{ associado.nome }}</li>
            <li class="list-group-item"><strong>CPF:</strong> {{ associado.cpf }}</li>
            <li class="list-group-item"><strong>RG:</strong> {{ associado.rg }}</li>
            <li class="list-group-item"><strong>E-mail (Login):</strong> {{ associado.email_assoc }}</li>
            <li class="list-group-item"><strong>Endere√ßo:</strong> {{ associado.rua }}, N¬∫ {{ associado.numero }}, {{ associado.bairro }}</li>
            <li class="list-group-item"><strong>Data de Cadastro:</strong> {{ associado.data_cadastro.split()[0] }}</li>
        </ul>
    </div>

    <div class="col-md-4 mb-4">
        <h4>Dados do Ve√≠culo e Situa√ß√£o</h4>
        <ul class="list-group list-group-flush">
            <li class="list-group-item"><strong>Placa:</strong> {{ associado.placa }}</li>
            <li class="list-group-item"><strong>Cor:</strong> {{ associado.cor }}</li>
            <li class="list-group-item"><strong>Ano:</strong> {{ associado.ano }}</li>
            <li class="list-group-item"><strong>Renavam:</strong> {{ associado.renavam }}</li>
            <li class="list-group-item">
                <strong>Status na Associa√ß√£o:</strong> 
                <span class="badge bg-{{ 'success' if 'Em Dia' in status else 'danger' if 'Desligado' in status else 'warning' }}">
                    {{ status }}
                </span>
            </li>
            <li class="list-group-item">
                <strong>D√≠vida Total:</strong> 
                <span class="text-danger fw-bold">R$ {{ "{:,.2f}".format(divida) }}</span> 
                <span class="text-muted small">({{ meses_devidos_count }} meses)</span>
            </li>
        </ul>
        
        {% if meses_devidos_count > 0 %}
        <div class="alert alert-warning mt-3 small" role="alert">
            Seu d√©bito √© referente aos meses: {{ meses_devidos_lista | join(', ') }}. Por favor, regularize sua situa√ß√£o.
        </div>
        {% endif %}
    </div>
</div>

{% endblock %}
