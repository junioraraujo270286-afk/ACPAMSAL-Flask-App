{% extends 'base.html' %}
{% block content %}
<div class="card shadow-sm border-0 rounded-4 overflow-hidden mb-4">
    <div class="card-header bg-dark text-warning p-3">
        <h5 class="mb-0 fw-bold"><i class="fas fa-cash-register me-2"></i>CONTROLE FINANCEIRO</h5>
    </div>
    <div class="card-body bg-white">
        <form action="{{ url_for('admin_financeiro') }}" method="POST" id="financeForm" class="row g-3 mb-4">
            <input type="hidden" name="mensalidade_id" id="m_id">
            <div class="col-md-4">
                <label class="small fw-bold">SÓCIO</label>
                <select name="socio_id" id="s_id" class="form-select border-2" required>
                    <option value="">Selecione...</option>
                    {% for s in socios %}
                    <option value="{{ s.id }}">{{ s.nome }} ({{ s.placa }})</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <label class="small fw-bold">MÊS REFERÊNCIA</label>
                <select name="mes" id="mes_ref" class="form-select border-2" required>
                    <option value="Agosto">Agosto</option><option value="Setembro">Setembro</option>
                    <option value="Outubro">Outubro</option><option value="Novembro">Novembro</option><option value="Dezembro">Dezembro</option>
                </select>
            </div>
            <div class="col-md-2 d-flex align-items-center pt-3">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" name="isento" id="isentoCheck">
                    <label class="form-check-label fw-bold text-primary" for="isentoCheck">ISENTO</label>
                </div>
            </div>
            <div class="col-md-3 d-flex align-items-end">
                <button type="submit" class="btn btn-taxi w-100 fw-bold" id="btnSubmit">REGISTRAR</button>
            </div>
        </form>

        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-dark">
                    <tr><th>Sócio</th><th>Mês</th><th>Status</th><th>Ações</th></tr>
                </thead>
                <tbody>
                    {% for m in mensalidades %}
                    <tr>
                        <td class="fw-bold">{{ m.socio.nome }}</td>
                        <td>{{ m.mes_referencia }}</td>
                        <td>
                            {% if m.isento %}<span class="badge bg-primary">ISENTO</span>{% else %}<span class="badge bg-success">PAGO</span>{% endif %}
                        </td>
                        <td>
                            <button onclick="editM('{{ m.id }}','{{ m.socio_id }}','{{ m.mes_referencia }}', {{ 'true' if m.isento else 'false' }})" class="btn btn-sm btn-outline-dark"><i class="fas fa-edit"></i></button>
                            <a href="{{ url_for('remover_financeiro', id=m.id) }}" class="btn btn-sm btn-outline-danger" onclick="return confirm('Remover este lançamento?')"><i class="fas fa-trash"></i></a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
<script>
function editM(id, sid, mes, isento) {
    document.getElementById('m_id').value = id;
    document.getElementById('s_id').value = sid;
    document.getElementById('mes_ref').value = mes;
    document.getElementById('isentoCheck').checked = isento;
    document.getElementById('btnSubmit').innerText = "ATUALIZAR";
    document.getElementById('btnSubmit').className = "btn btn-warning w-100 fw-bold";
}
</script>
{% endblock %}
