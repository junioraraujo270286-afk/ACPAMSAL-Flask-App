{% extends "base.html" %}
{% block title %}Relat√≥rio Financeiro e Associados{% endblock %}
{% block content %}

<h2 class="text-secondary">üìä Relat√≥rio Financeiro e de Associados</h2>
<p class="text-muted">Gerado em: **{{ data_geracao }}**</p>
<hr class="print-none">

<div class="d-flex justify-content-between mb-4 print-none">
    <h4>Resumo Geral</h4>
    <button class="btn btn-primary" onclick="window.print()"><i class="fas fa-print"></i> Imprimir/Gerar PDF</button>
</div>

<style>
    @media print {
        /* Oculta elementos de navega√ß√£o e bot√µes */
        .print-none, header, footer {
            display: none !important;
        }
        .container {
            width: 100%;
            margin: 0;
            padding: 0;
        }
        
        /* Estilo do CABE√áALHO de impress√£o - CENTRALIZADO e DIMINU√çDO */
        .print-header {
            display: block;
            text-align: center;
            border-bottom: 2px solid #333;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        .print-header img {
            height: 50px; /* Logo menor */
            margin-bottom: 5px;
        }
        .print-header h1 {
            font-size: 1.1em; /* Nome da Associa√ß√£o (Diminu√≠do) */
            margin: 0;
            font-weight: bold;
        }
        .print-header p {
            margin: 2px 0;
            font-size: 0.85em; /* CNPJ e Data de Gera√ß√£o (Diminu√≠do) */
        }
        
        /* Redu√ß√£o da Fonte no Resumo Financeiro */
        .card-title {
            font-size: 0.85em !important; 
        }
        .card-text {
            font-size: 1.1em !important; /* Valor num√©rico reduzido */
        }

        /* Detalhamento dos Associados (Tabela) */
        .table-responsive table {
            font-size: 0.8em !important; /* Fonte bem pequena para a tabela */
        }

        /* Estilo do RODAP√â de impress√£o */
        .print-footer {
            margin-top: 30px;
            border-top: 1px solid #ccc;
            padding-top: 10px;
            font-size: 0.75em; /* Fonte do rodap√© menor */
            text-align: center;
            position: fixed; 
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #fff; 
        }
    }
</style>

<div class="print-header d-none d-print-block">
    {% if config.logo_url %}
        <img src="{{ config.logo_url }}" alt="Logo" class="print-logo">
    {% endif %}
    <h1>{{ config.nome_assoc }}</h1>
    <p>CNPJ: {{ config.cnpj }}</p>
    <p>Relat√≥rio Financeiro e de Associados | Gerado em: {{ data_geracao }}</p>
</div>
<h4 class="mb-3">Resumo Financeiro</h4>

<div class="row mb-5">
    <div class="col-md-4">
        <div class="card text-white bg-success mb-3">
            <div class="card-body">
                <h5 class="card-title">Total Recebido</h5>
                <p class="card-text fs-3">R$ {{ "{:,.2f}".format(total_pago_geral) }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-white bg-danger mb-3">
            <div class="card-body">
                <h5 class="card-title">D√©bito Pendente</h5>
                <p class="card-text fs-3">R$ {{ "{:,.2f}".format(total_divida_geral) }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-white bg-primary mb-3">
            <div class="card-body">
                <h5 class="card-title">Balan√ßo (Aprox.)</h5>
                <p class="card-text fs-3">R$ N/D</p> 
            </div>
        </div>
    </div>
</div>
<h4>Detalhamento dos Associados</h4>

<div class="table-responsive">
    <table class="table table-bordered table-sm table-hover" style="font-size: 0.9em;">
        <thead class="table-dark">
            <tr>
                <th>Matr√≠cula</th>
                <th>Nome</th>
                <th>Placa</th>
                <th>Status</th>
                <th>Meses Devidos</th>
                <th>D√≠vida (R$)</th>
                <th>Pagamentos Feitos</th>
            </tr>
        </thead>
        <tbody>
            {% for item in relatorio %}
            <tr>
                <td>{{ item.matricula }}</td>
                <td>{{ item.nome }}</td>
                <td>{{ item.placa }}</td>
                <td>
                    <span class="badge bg-{{ 'success' if 'Em Dia' in item.status else 'danger' if 'Desligado' in item.status else 'warning' }}">
                        {{ item.status }}
                    </span>
                </td>
                <td>{{ item.meses_devidos }}</td>
                <td>R$ {{ "{:,.2f}".format(item.divida) }}</td>
                <td>{{ item.pagamentos_feitos }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="print-footer d-none d-print-block">
    <p>
        {{ footer_info.endereco_completo }}.
        <br>
        {{ footer_info.contato }}
        <br>
        {{ footer_info.social }}
    </p></div>
{% endblock %}
